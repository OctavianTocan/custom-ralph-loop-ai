# Ralph Progress Log

Started: 2026-01-08
PRD: extension-react19-tooling (44 tasks across 7 milestones)

## Codebase Patterns

- WXT extensions: publicDir is `assets/`, entrypoints are in `src/entrypoints/`
- MV3 Service Worker: NO localStorage, NO AudioContext at top-level
- Guard pattern: `if (typeof localStorage !== 'undefined') { ... }`
- Lazy factory: `let ctx: T | null = null; export function getX() { if (!ctx && typeof window !== 'undefined') ctx = new X(); return ctx; }`
- Monorepo: Use `pnpm --filter <package-name>` for targeted commands
- Build timeout: Extension build can hang - always use `timeout 120`
- Package moves: Use `git mv` to preserve history
- Catalog deps: Use `"catalog:"` in package.json to reference pnpm-workspace.yaml versions

## Key Files

- apps/chrome_extension_next/wxt.config.ts - Manifest configuration
- apps/chrome_extension_next/package.json - Dependencies and scripts
- pnpm-workspace.yaml - Catalog versions for React, TypeScript, etc.
- turbo.json - Build pipeline outputs
- build-extension.js, dev-extension.js - Root scripts for extension

## Validation Commands

```bash
# Extension (primary target)
pnpm --filter chrome_extension_next typecheck
pnpm --filter chrome_extension_next lint
pnpm --filter chrome_extension_next test
timeout 120 pnpm --filter chrome_extension_next build

# Web (after M5 package moves)
pnpm --filter thirdear-webapp type-check
pnpm --filter thirdear-webapp lint
pnpm --filter thirdear-webapp build
```

## Known Gotchas

- WXT build can hang indefinitely - ALWAYS use timeout
- localStorage crashes service worker - guard ALL usages
- AudioContext at module level crashes SW - use lazy factory
- React 19 types: @types/react@^19.0.0, not @types/react@^18
- @testing-library/react v16+ required for React 19

---
